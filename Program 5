create database p5;
use p5;
create table department(dno varchar(20) primary key, dname varchar(20), mgrstartdate date);
create table employee(ssn varchar(20) primary key, fname varchar(20),lname varchar(20), address varchar(20), sex char(1), salary int, superssn varchar(20), foreign key (superssn) references employee(ssn), dno varchar(20), foreign key (dno) references department(dno));
alter table department add mgrssn varchar(20);
alter table department add foreign key(mgrssn) references employee(ssn);
create table dlocation(dloc varchar(20), dno varchar(20), foreign key(dno) references department(dno), primary key(dno, dloc));
create table project(pno int primary key, pname varchar(20), plocation varchar(20), dno varchar(20), foreign key(dno) references department(dno));
create table works_on( hours int, ssn varchar(20), foreign key(ssn) references employee(ssn), pno int, foreign key (pno) references project(pno), primary key(ssn,pno));
insert into employee(ssn,fname,lname,address,sex,salary) values('rnsece01','john','scott','bangalore','m',450000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnscse01','james','smith','bangalore','m',500000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnscse02','hearn','baker','bangalore','m',700000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnscse03','edward','scott','mysore','m',500000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnscse04','pavan','hegde','mangalore','m',650000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnscse05','girish','halya','mysore','m',450000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnscse06','neha','sn','bangalore','f',800000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnsacc01','ahana','k','mangalore','f',350000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnsacc02','santhosh','kumar','mangalore','m',600000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnsise01','veena','m','mysore','m',600000);
insert into employee(ssn,fname,lname,address,sex,salary) values('rnsit01','nagesh','hr','bangalore','m',500000);
delete from employee where fname="santhosh";
insert into employee(ssn,fname,lname,address,sex,salary) values('rnsacc02','santhosh','kumar','mangalore','m',300000);
select * from employee;
insert into department values('1','accounts','2001/01/01','rnsacc02');
insert into department values('2','it','2006/08/01','rnsit01');
insert into department values('3','ece','2008/06/01','rnsece01');
insert into department values('4','ise','2015/08/01','rnsise01');
insert into department values('5','cse','2002/06/01','rnscse05');
select * from department;
update employee set superssn=NULL, dno='3' where ssn='rnsece01';
update employee set superssn='rnscse02', dno='5' where fname="james";
update employee set superssn='rnscse03', dno='5' where ssn='rnscse02';
update employee set superssn='rnscse04', dno='5' where ssn='rnscse03';
update employee set superssn='rnscse05', dno='5' where ssn='rnscse04';
update employee set superssn='rnscse06', dno='5' where ssn='rnscse05';
update employee set superssn=NULL, dno='5' where ssn='rnscse06';
update employee set superssn='rnsacc02', dno='1' where ssn='rnsacc01';
update employee set superssn=NULL, dno='1' where ssn='rnsacc02';
update employee set superssn=NULL, dno='4' where ssn='rnsise01';
update employee set superssn=NULL, dno='2' where ssn='rnsit01';
select * from employee;
insert into dlocation values('bangalore',1);
insert into dlocation values('bangalore',2);
insert into dlocation values('bangalore',3);
insert into dlocation values('mangalore',4);
insert into dlocation values('mangalore',5);
select * from dlocation;
insert into project values(100, 'iot','bangalore',5);
insert into project values(101, 'cloud','bangalore',5);
insert into project values(102, 'bigdata','bangalore',5);
insert into project values(103, 'sensors','bangalore',3);
insert into project values(104, 'bank management','bangalore',1);
insert into project values(105, 'salary management','bangalore',1);
insert into project values(106, 'openstack','bangalore',4);
insert into project values(107, 'smart city','bangalore',2);
select * from project;
insert into works_on values(4,'rnscse01',100);
insert into works_on values(6,'rnscse01',101);
insert into works_on values(8,'rnscse01',102);
insert into works_on values(10,'rnscse02',100);
insert into works_on values(3,'rnscse04',100);
insert into works_on values(4,'rnscse05',101);
insert into works_on values(5,'rnscse06',102);
insert into works_on values(6,'rnscse03',102);
insert into works_on values(7,'rnsece01',103);
insert into works_on values(5,'rnsacc01',104);
insert into works_on values(6,'rnsacc02',105);
insert into works_on values(4,'rnsise01',106);
insert into works_on values(10,'rnsit01',107);
select * from works_on;
(select p.pno from employee e, department d,project p where p.dno=d.dno and  d.mgrssn=e.ssn and  e.lname='scott') union (select w.pno from employee e,works_on w,project p where e.dno =p.dno and w.ssn= e.ssn and e.lname='scott');
select e.fname, e.lname, 1.1*e.salary as incr_sal from employee e, works_on w, project p where e.ssn=w.ssn and w.pno=p.pno and p.pname='iot';
select sum(e.salary),max(e.salary),min(e.salary), avg(e.salary) from employee e, department d where e.dno=d.dno and d.dname='accounts';
select e.fname,e.lname from employee e where not exists(select pno from project p where p.pno in(select pno from project where dno='5') and p.pno not in(select pno from works_on where e.ssn=ssn));
select d.dno, count(*) from department d, employee e where d.dno=e.dno and e.salary>600000 and d.dno in (Select e1.dno from employee e1 group by e1.dno having count(*)>5) group by d.dno;
